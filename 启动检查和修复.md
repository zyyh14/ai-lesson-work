# AI备课系统 - 问题诊断与修复报告

## ✅ 已发现并修复的问题

### 1. **Python服务缺少.env配置文件** ⚠️ 关键问题
**问题描述**：Python服务需要Supabase和AI API密钥配置，但缺少.env文件。

**已修复**：已创建 `python_service/.env` 模板文件。

**需要用户操作**：
```bash
# 编辑 python_service/.env 文件，填入真实的API密钥：
# - SUPABASE_URL: 你的Supabase项目URL
# - SUPABASE_KEY: 你的Supabase API密钥
# - ZHIPU_API_KEY: 智谱AI的API密钥
```

### 2. **Node.js版本不匹配** ⚠️ 警告
**问题描述**：
- 当前系统：Node.js v24.12.0
- 项目要求：Node.js v16.20.2（根据startrunning.md）
- 影响：可能导致依赖安装或运行时问题

**建议**：
- 使用 nvm (Node Version Manager) 切换到 Node.js 16.x
- 或者更新项目依赖以兼容 Node.js 24

### 3. **前端模块依赖未安装**
**问题描述**：三个前端模块需要安装依赖。

**修复方法**：见下方启动步骤。

---

## 🚀 正确的启动步骤

### 前置条件检查
```powershell
# 检查必需工具
mvn --version      # ✅ Maven 3.9.11 (已安装)
java -version      # ✅ Java 1.8 (已安装)
python --version   # ✅ Python 3.12.4 (已安装)
node --version     # ⚠️ Node v24.12.0 (建议使用v16)
```

### 第一步：配置环境变量

#### 1.1 配置Python服务
```powershell
# 编辑 python_service/.env 文件，填入真实的API密钥
notepad ai-lesson-work-cjz-resources\python_service\.env
```

必需配置项：
- `SUPABASE_URL`: Supabase项目URL
- `SUPABASE_KEY`: Supabase API密钥
- `ZHIPU_API_KEY`: 智谱AI API密钥

#### 1.2 配置Spring Boot服务（可选）
Spring Boot的配置已在 `backend/src/main/resources/application.properties` 中设置好，包括：
- Ark AI API密钥
- 数据库配置（H2）
- Python服务地址

### 第二步：安装依赖

#### 2.1 Python服务依赖
```powershell
cd ai-lesson-work-cjz-resources\python_service
pip install -r requirements.txt
cd ..\..
```

#### 2.2 前端模块依赖
```powershell
# PPT模块
cd ai-lesson-work-cjz-resources\frontend\modules\ppt
npm install --legacy-peer-deps
cd ..\..\..\..\

# 教案模块
cd ai-lesson-work-cjz-resources\frontend\modules\lessonplan
npm install --legacy-peer-deps
cd ..\..\..\..\

# 资源管理模块
cd ai-lesson-work-cjz-resources\frontend\modules\resource
npm install
cd ..\..\..\..\
```

### 第三步：启动服务（按顺序）

#### 3.1 启动Python服务（端口5000）
```powershell
# 打开新的PowerShell窗口
cd ai-lesson-work-cjz-resources\python_service
python start.py
```
验证：访问 http://localhost:5000/docs

#### 3.2 启动Spring Boot服务（端口8081）
```powershell
# 打开新的PowerShell窗口
cd ai-lesson-work-cjz-resources\backend
mvn spring-boot:run
```
验证：访问 http://localhost:8081

#### 3.3 启动前端模块

**PPT模块（端口3001）**
```powershell
# 打开新的PowerShell窗口
cd ai-lesson-work-cjz-resources\frontend\modules\ppt
npm run dev
```
访问：http://localhost:3001

**教案模块（端口3000）**
```powershell
# 打开新的PowerShell窗口
cd ai-lesson-work-cjz-resources\frontend\modules\lessonplan
npm run dev
```
访问：http://localhost:3000

**资源管理模块（端口3002）**
```powershell
# 打开新的PowerShell窗口
cd ai-lesson-work-cjz-resources\frontend\modules\resource
npm run dev
```
访问：http://localhost:3002

---

## 📋 快速启动脚本

我已为你准备了自动化启动脚本，见 `一键启动.ps1`

---

## ⚠️ 常见问题

### 1. Python服务启动失败
**错误**：`ValidationError: SUPABASE_URL field required`

**解决**：确保 `python_service/.env` 文件中填写了所有必需的API密钥。

### 2. 前端npm install失败
**错误**：peer dependency conflicts

**解决**：使用 `npm install --legacy-peer-deps`

### 3. Spring Boot启动失败
**错误**：端口8081被占用

**解决**：
```powershell
# 查找占用端口的进程
netstat -ano | findstr :8081
# 结束进程
taskkill /PID <进程ID> /F
```

### 4. Node.js版本问题
**建议**：安装nvm-windows并切换到Node.js 16
```powershell
nvm install 16.20.2
nvm use 16.20.2
```

---

## 📊 系统架构总结

```
┌─────────────────────────────────────────────────────────┐
│                    前端模块                              │
├─────────────────┬─────────────────┬─────────────────────┤
│  PPT模块        │  教案模块        │  资源管理模块        │
│  :3001          │  :3000          │  :3002              │
└────────┬────────┴────────┬────────┴──────────┬──────────┘
         │                 │                   │
         └─────────────────┼───────────────────┘
                           │
                  ┌────────▼────────┐
                  │  Spring Boot    │
                  │  后端服务        │
                  │  :8081          │
                  └────────┬────────┘
                           │
                  ┌────────▼────────┐
                  │  Python FastAPI │
                  │  资源管理服务    │
                  │  :5000          │
                  └─────────────────┘
```

---

## ✅ 项目状态评估

| 组件 | 状态 | 说明 |
|------|------|------|
| Python服务配置 | ⚠️ 需要配置 | 需填写.env文件中的API密钥 |
| Spring Boot配置 | ✅ 完整 | application.properties已配置 |
| 前端PPT模块 | ✅ 完整 | .env.local已配置 |
| 前端教案模块 | ✅ 完整 | 配置完整 |
| 前端资源模块 | ✅ 完整 | 配置完整 |
| Maven依赖 | ✅ 完整 | pom.xml配置正确 |
| Python依赖 | ✅ 完整 | requirements.txt完整 |
| Node.js版本 | ⚠️ 不匹配 | 建议使用v16而非v24 |

**总体评估**：项目结构完整，主要需要配置Python服务的API密钥即可运行。
